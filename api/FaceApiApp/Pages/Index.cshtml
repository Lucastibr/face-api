@page
@model IndexModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<h2>Detecções Faciais</h2>

<table class="table">
    <thead>
    <tr>
        <th>Id</th>
        <th>Gênero</th>
        <th>Idade</th>
        <th>Imagem</th>
    </tr>
    </thead>
    <tbody>
    @foreach (var detection in Model.Detections)
    {
        <tr>
            <td>@detection.Id</td>
            <td>@detection.Gender</td>
            <td>@detection.Age</td>
            <td>
                <img src="@detection.ImageBase64" alt="Imagem de Detecção" width="100" height="100" />
            </td>
        </tr>
    }
    </tbody>
</table>

<canvas id="genderChart" width="400" height="200"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    async function loadChartData() {
        const response = await fetch('/api/detections');
        const data = await response.json();

        // Contagem de gêneros
        const maleCount = data.filter(d => d.gender === 'male').length;
        const femaleCount = data.filter(d => d.gender === 'female').length;

        const ctx = document.getElementById('genderChart').getContext('2d');
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Homem', 'Mulher'],
                datasets: [{
                    data: [maleCount, femaleCount],
                    backgroundColor: ['#36A2EB', '#FF6384'],
                }]
            }
        });
    }

    loadChartData();
</script>
