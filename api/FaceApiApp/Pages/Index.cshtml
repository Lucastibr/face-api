@page
@model IndexModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<div class="container mt-4">
    <h2>Detecções Faciais - Inovatec 2024</h2>

    <div class="row">
        <!-- Coluna para a tabela -->
        <div class="col-md-6">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Gênero</th>
                        <th>Idade</th>
                        <th>Imagem</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var detection in Model.Detections)
                    {
                        <tr>
                            <td>
                                @switch (detection.Gender)
                                {
                                    case "male":
                                        <span>Homem</span>
                                        break;
                                    case "female":
                                        <span>Mulher</span>
                                        break;
                                }
                            </td>
                            <td>@detection.Age</td>
                            <td>
                                <img src="@detection.ImageBase64" alt="Imagem de Detecção" width="100" height="100" class="rounded" />
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Coluna para o gráfico -->
        <div class="col-md-6">
            <h4>Distribuição de Gêneros</h4>
            <canvas id="genderChart" width="100" height="100"></canvas>
        </div>
    </div>
</div>

<!-- Inclusão do Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    async function loadChartData() {
        const response = await fetch('/api/detections');
        const data = await response.json();

        // Contagem de gêneros
        const maleCount = data.filter(d => d.gender === 'male').length;
        const femaleCount = data.filter(d => d.gender === 'female').length;

        const ctx = document.getElementById('genderChart').getContext('2d');
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Homem', 'Mulher'],
                datasets: [{
                    data: [maleCount, femaleCount],
                    backgroundColor: ['#36A2EB', '#FF6384'],
                }]
            }
        });
    }

    loadChartData();
</script>
